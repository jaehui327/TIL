# 🌐 TCP/IP 4계층 모델

## 📚 계층 구조

인터넷 프로토콜 스위트(IP Suite)는 컴퓨터 간 데이터 통신에 사용되는 프로토콜 집합으로, 일반적으로 **TCP/IP 4계층 모델**로 설명됩니다. 이는 OSI 7계층과도 유사하지만, 더 간소화된 구조를 따릅니다.

### 🔍 OSI 7계층 vs TCP/IP 4계층

- OSI: **7계층** (애플리케이션, 표현, 세션, 전송, 네트워크, 데이터 링크, 물리)
- TCP/IP: **4계층** (애플리케이션, 전송, 인터넷, 링크)
- 주요 차이:

  - OSI는 상위 계층을 세분화하고 하위 계층을 나눔
  - TCP/IP는 실용적인 구현 위주로 구조 단순화

---

### 🧩 1. 애플리케이션 계층 (Application Layer)

사용자에게 직접 서비스를 제공하는 계층으로, 대표적인 프로토콜:

- **FTP**: 파일 전송 프로토콜 📂
- **HTTP**: 웹 통신 프로토콜 🌐
- **SSH**: 보안 원격 접속 🔐
- **SMTP**: 이메일 전송 ✉️
- **DNS**: 도메인 ↔ IP 변환 🔁

> 💡 DNS는 도메인을 IP로 매핑해 서비스 지속성을 확보합니다.

---

### 📶 2. 전송 계층 (Transport Layer)

데이터의 전송 경로를 설정하고, **신뢰성**, **순서 보장**, **흐름 제어**를 담당합니다.

#### ✅ TCP (Transmission Control Protocol)

- **연결 지향**, **순서 보장**, **재전송**
- **가상회선 방식**: 모든 패킷에 식별자 포함, 순차 전송 보장

🔁 **3-Way Handshake**

1. SYN →
2. ← SYN+ACK
3. ACK → 연결 성립 🎉

🔚 **4-Way Handshake (해제)**

1. FIN →
2. ← ACK (CLOSE_WAIT)
3. ← FIN
4. ACK → (TIME_WAIT 후 종료)

> 💡 **TIME_WAIT**: 지연 패킷 방지 및 재연결 충돌 방지를 위한 대기 시간 (OS마다 다름)

#### ⚡ UDP (User Datagram Protocol)

- **비연결형**, **빠르지만 신뢰성 없음**
- **데이터그램 방식**: 순서 무보장, 중간 경로 최적화 📡

---

### 🌍 3. 인터넷 계층 (Internet Layer)

패킷의 전송 경로를 설정하는 계층으로, IP 주소를 기반으로 데이터 전달 📦

- **IP**: 주소 지정 및 패킷 전달
- **ICMP**: 오류 및 상태 메시지 (예: ping)
- **ARP**: IP ↔ MAC 주소 변환

> ⚠️ 비연결형 계층이며 신뢰성 보장 안 함

---

### 🔌 4. 링크 계층 (Link Layer)

실제 물리적 매체를 통해 데이터를 송수신하는 계층 📡

#### 💡 물리 계층

- 0과 1의 신호로 변환
- 유선/무선 전송

#### 💡 데이터 링크 계층

- **이더넷 프레임** 사용
- 에러 감지 (CRC), 흐름/접근 제어

##### 📦 이더넷 프레임 구조

| 필드      | 길이  | 설명                    |
| --------- | ----- | ----------------------- |
| Preamble  | 7byte | 프레임 시작 알림        |
| SFD       | 1byte | MAC 주소 시작 표시      |
| DMAC/SMAC | 6byte | 목적지/출발지 MAC 주소  |
| EtherType | 2byte | 상위 계층 프로토콜 식별 |
| Payload   | 가변  | 전송할 데이터           |
| CRC       | 4byte | 오류 검출 코드          |

> 📌 **MAC 주소**: 장치 고유 식별자 (6byte)

---

## 🔄 통신 방식

### 🧭 전이중화 (Full Duplex)

- 양방향 동시 통신 가능 🚀
- 유선 LAN에서 주로 사용 (이더넷)

### 🧭 반이중화 (Half Duplex)

- 한 번에 한 방향만 통신
- 무선 LAN에서 사용

#### 📡 CSMA/CD (이더넷)

- 충돌 감지 → 재전송 ⏱️

#### 📡 CSMA/CA (무선 LAN)

- 충돌 회피 방식

1. 채널 감지
2. IFS 대기
3. 송신

### 📶 무선 LAN 구성

- **Wi-Fi**: 무선 접속 장치(AP) 필요
- **BSS**: 단일 AP 기반 근거리 통신
- **ESS**: 여러 AP 연결 → 중단 없는 이동성 제공

### 🔌 유선 LAN 구성

- **TP 케이블 (UTP/STP)**: 구리선 기반, RJ-45 커넥터 사용
- **광섬유 케이블**: 고속, 장거리 전송 가능 (100Gbps+)

---

## 📦 캡슐화 & 비캡슐화

### 📥 캡슐화 (Encapsulation)

1. 애플리케이션 계층: 메시지 생성
2. 전송 계층: 세그먼트/데이터그램 + TCP/UDP 헤더
3. 인터넷 계층: 패킷 + IP 헤더
4. 링크 계층: 프레임 + MAC 헤더 + CRC

### 📤 비캡슐화 (Decapsulation)

- 역순으로 각 계층의 헤더 제거 후, 최종적으로 메시지를 사용자에게 전달

---

## 📦 PDU (Protocol Data Unit)

각 계층에서 사용되는 데이터 단위는 아래와 같습니다:

| 계층              | PDU                                     |
| ----------------- | --------------------------------------- |
| 애플리케이션 계층 | 메시지                                  |
| 전송 계층         | 세그먼트 (TCP) / 데이터그램 (UDP)       |
| 인터넷 계층       | 패킷                                    |
| 링크 계층         | 프레임 (데이터 링크) / 비트 (물리 계층) |

> ✅ 문자열 기반 메시지는 확장성 및 보안 정보 첨부에 유리

---

📘 **요약**: TCP/IP 4계층은 인터넷 통신의 기반이 되는 구조로, 데이터의 흐름과 각 계층의 역할을 이해하면 효율적인 네트워크 설계와 문제 해결이 가능합니다.
